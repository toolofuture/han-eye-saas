{% extends "base.html" %}

{% block title %}Re-flexion 대시보드 - Han.Eye{% endblock %}

{% block content %}
<section class="reflexion-section py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col">
                <h1 class="fw-bold">
                    <i class="fas fa-brain me-2"></i>Re-flexion 자기개선 대시보드
                </h1>
                <p class="text-muted">AI 모델의 학습 진행 상황과 성능 향상 추이</p>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-sync-alt fa-3x text-primary mb-3"></i>
                        <h6 class="text-muted">총 Re-flexion 횟수</h6>
                        <h2 class="fw-bold">{{ metrics.total_reflexions }}</h2>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                        <h6 class="text-muted">평균 정확도 향상</h6>
                        <h2 class="fw-bold text-success">{{ "%+.2f"|format(metrics.avg_accuracy_improvement * 100) }}%</h2>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-bullseye fa-3x text-info mb-3"></i>
                        <h6 class="text-muted">평균 확신도 향상</h6>
                        <h2 class="fw-bold text-info">{{ "%+.2f"|format(metrics.avg_confidence_improvement * 100) }}%</h2>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-trophy fa-3x text-warning mb-3"></i>
                        <h6 class="text-muted">성공적인 개선</h6>
                        <h2 class="fw-bold text-warning">{{ metrics.total_improvements }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Learning History -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="mb-0 fw-bold">최근 학습 기록</h5>
            </div>
            <div class="card-body">
                {% if learning_history %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>반복</th>
                                    <th>분석 ID</th>
                                    <th>자기평가</th>
                                    <th>확신도 변화</th>
                                    <th>정확도 변화</th>
                                    <th>모델</th>
                                    <th>날짜</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for log in learning_history %}
                                <tr>
                                    <td><span class="badge bg-secondary">#{{ log.iteration }}</span></td>
                                    <td>#{{ log.analysis_id }}</td>
                                    <td>
                                        {% set eval_dict = log.self_evaluation %}
                                        {% if eval_dict %}
                                            {{ eval_dict.confidence_assessment }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if log.confidence_delta > 0 %}
                                            <span class="text-success fw-bold">+{{ "%.2f"|format(log.confidence_delta * 100) }}%</span>
                                        {% elif log.confidence_delta < 0 %}
                                            <span class="text-danger fw-bold">{{ "%.2f"|format(log.confidence_delta * 100) }}%</span>
                                        {% else %}
                                            <span class="text-muted">0.00%</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if log.accuracy_delta > 0 %}
                                            <span class="text-success fw-bold">+{{ "%.2f"|format(log.accuracy_delta * 100) }}%</span>
                                        {% elif log.accuracy_delta < 0 %}
                                            <span class="text-danger fw-bold">{{ "%.2f"|format(log.accuracy_delta * 100) }}%</span>
                                        {% else %}
                                            <span class="text-muted">0.00%</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ log.model_version }}</td>
                                    <td>{{ log.created_at[:10] if log.created_at else 'N/A' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-brain fa-4x text-muted mb-3"></i>
                        <p class="text-muted">아직 Re-flexion 기록이 없습니다.</p>
                        <p class="text-muted">분석 시 Re-flexion을 활성화하여 AI의 자기개선 과정을 확인하세요.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Info Box -->
        <div class="alert alert-info mt-4">
            <h5 class="alert-heading">
                <i class="fas fa-info-circle me-2"></i>Re-flexion이란?
            </h5>
            <p>
                Re-flexion은 AI가 자신의 판단을 재평가하고 개선하는 순환 학습 시스템입니다.
            </p>
            <ul class="mb-0">
                <li><strong>판단:</strong> 초기 AI 분석 수행</li>
                <li><strong>평가:</strong> 자신의 판단을 객관적으로 평가</li>
                <li><strong>기록:</strong> 강점과 약점을 데이터베이스에 저장</li>
                <li><strong>개선:</strong> 평가를 바탕으로 판단을 수정하고 향상</li>
            </ul>
        </div>
    </div>
</section>
{% endblock %}

